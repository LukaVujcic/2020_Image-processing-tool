#:kivy 1.10.1

<IPC>:
    selection_tool:selection_tool
    resize_tool:resize_tool
    crop_tool:crop_tool
    laso_tool:laso_tool
    text_tool:text_tool
    contour_tool:contour_tool
    find_edges_tool:find_edges_tool
    sharpen_tool:sharpen_tool
    smooth_tool:smooth_tool
    blur_tool:blur_tool
    unsharp_tool:unsharp_tool
    mode_filter_tool:mode_filter_tool
    min_filter_tool:min_filter_tool
    cp:cp

    img_id:img_id
    lbl1:lbl1
    lbl2:lbl2
    lbl3:lbl3
    slider1:slider1
    slider2:slider2
    slider3:slider3

    GridLayout:
        cols:4
        size_hint: 0.4,0.05
        pos_hint: {"x":0,"top":1}
        Button:
            id:file
            text: "New"
        Button:
            id:tools
            text: "Open"
            on_release: root.open_file()
        Button:
            id:image
            text: "Reload"
            on_release: root.reload_image()
        Button:
            id:image
            text: "Undo"
            on_release: root.undo()

    
    GridLayout:
        cols: 4
        size_hint: 0.175,0.3
        pos_hint:{"x":0,"top":0.9}
        Button:
            id:selection_tool
            background_normal: "./assets/SelectionRectangle-Icon.png"
            border:0,0,0,0
            on_release:root.activate_selection_tool()
        Button:
            id:resize_tool
            background_normal: "./assets/TransformScale-Icon.png"
            border:0,0,0,0
            on_release:root.activate_calibration_tool()
        Button:
            id:crop_tool
            background_normal: "./assets/SelectionScissors-Icon.png"
            border:0,0,0,0
        Button:
            id: text_tool
            background_normal: "./assets/TextTool-Icon.png"
            border:0,0,0,0
            on_release:root.draw_text()

        Button:
            id:pen_tool
            background_normal: "./assets/BrushPencil-Icon.png"
            border:0,0,0,0
            on_release: root.greyscale_image()
        Button:
            id:brush_tool
            background_normal: "./assets/BrushPaintbrush-Icon.png"
            border:0,0,0,0
        Button:
            id:eraser_tool
            background_normal: "./assets/Eraser-Icon.png"
            border:0,0,0,0
        Button:
            id:laso_tool
            background_normal: "./assets/SelectionLasso-Icon.png"
            border:0,0,0,0

        Button:
            id:contour_tool
            background_normal: "./assets/SelectionRectangle-Icon.png"
            border:0,0,0,0
            on_release:root.filter_image_countour()
        Button:
            id:find_edges_tool
            background_normal: "./assets/TransformScale-Icon.png"
            border:0,0,0,0
            on_release:root.filter_image_find_edges()
        Button:
            id:sharpen_tool
            background_normal: "./assets/SelectionScissors-Icon.png"
            border:0,0,0,0
            on_release:root.filter_image_sharpen()
        Button:
            id:smooth_tool
            background_normal: "./assets/TextTool-Icon.png"
            border:0,0,0,0
            on_release:root.filter_image_smooth()

        Button:
            id:blur_tool
            background_normal: "./assets/BrushPencil-Icon.png"
            border:0,0,0,0
            on_release:root.filter_image_blur()
        Button:
            id:unsharp_tool
            background_normal: "./assets/BrushPaintbrush-Icon.png"
            border:0,0,0,0
            on_release:root.filter_image_unsharp()
        Button:
            id:min_filter_tool
            background_normal: "./assets/Eraser-Icon.png"
            border:0,0,0,0
            on_release:root.filter_image_min()
        Button:
            id:mode_filter_tool
            background_normal: "./assets/SelectionLasso-Icon.png"
            border:0,0,0,0
            on_release:root.filter_image_mode()


    Image:
        id:img_id
        size_hint:0.7,0.7
        pos_hint: {"x":0.3,"y":0.15}
        #source: "1.jpeg"

    ColorPicker:
        id:cp
        color:0,0,0,1
        size_hint:0.3,0.4
        pos_hint: {"left":1,"bot":1}
    
    FloatLayout:
        size_hint:0.3,0.1
        pos_hint: {"x":0,"top":0.5}
        Label:
            id:lbl3
            pos_hint: {"x":-0.4,"top":1}
            text:"Threshold: "
            color:1,1,1,1
        Slider:
            id:slider3
            pos_hint: {"right":1,"top":1}
            size_hint:0.75,1
            min:0
            max:100
            on_touch_move:root.update_labels()

    FloatLayout:
        size_hint:0.3,0.1
        pos_hint: {"x":0,"top":0.55}
        Label:
            id:lbl2
            pos_hint: {"x":-0.4,"top":1}
            text:"Percent: "
            color:1,1,1,1
        Slider:
            id:slider2
            pos_hint: {"right":1,"top":1}
            size_hint:0.75,1
            min:0
            max:100
            on_touch_move:root.update_labels()

    FloatLayout:
        size_hint:0.3,0.1
        pos_hint: {"x":0,"top":0.6}
        Label:
            id:lbl1
            pos_hint: {"x":-0.4,"top":1}
            text:"Strength: "
            color:1,1,1,1
        Slider:
            id:slider1
            pos_hint: {"right":1,"top":1}
            size_hint:0.75,1
            min:0
            max:100
            on_touch_move:root.update_labels()


<CustomPopup>:

    fc:fc
    txt_input:txt_input

    title: "Export/Open:"
    size_hint:0.7,0.7
    pos_hint:{"x":0.15,"y":0.15}
    auto_dismiss: False
    FloatLayout:
        size_hint:1,1
        pos_hint:{"x":0,"y":0}
        canvas.before: 
            Color: 
                rgba: 0,0,0.05,0.98
            Rectangle: 
                pos: self.pos
                size: self.size 

        Button:
            size_hint:0.2,0.1
            pos_hint:{"x":0.1,"y":0.02}
            text:"Export"
            on_release:root.save_file()
        
        Button:
            size_hint:0.2,0.1
            pos_hint:{"x":0.4,"y":0.02}
            text:"Open"
            on_release:root.open_image()

        Button:
            text:"Cancel"
            size_hint:0.2,0.1
            pos_hint:{"x":0.7,"y":0.02}
            on_release:root.dismiss()

        TextInput:
            id: txt_input
            size_hint:0.8,0.1
            pos_hint:{"x":0.1,"y":0.15}
            multiline:False

        FileChooser:
            id:fc
            size_hint:0.8,0.6
            pos_hint:{"x":0.1,"y":0.3}
            path:"./"
            on_touch_up:root.update_text_input()
            FileChooserListLayout:
                canvas.before: 
                    Color: 
                        rgba: 0,0.05,0.1,0.7
                    Rectangle: 
                        pos: self.pos 
                        size: self.size